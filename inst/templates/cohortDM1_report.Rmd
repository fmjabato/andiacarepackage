---
title: "Andiacare Report"
output:
  html_document:
    toc: true
    toc_float: true
    df_print: paged
    fig_width: 15
---

<style type='text/css'>
    body .main-container {
        max-width: 90%;

    }

    .plot_real_size {
      overflow: scroll;
      max-height: 600px;
    }

    .plot_real_size img{
      max-width: none;
      max-height: none;
    }

    embed {
   
  }   
</style>

```{r setup, echo = FALSE}
suppressPackageStartupMessages(require(plotly))
suppressPackageStartupMessages(require(rAmCharts))

# Useful functions
render <- function(text){paste(knitr::knit(text = paste(text,collapse = "\n")),collapse = "\n")}
chunks <- function(code, options = ""){paste(paste("```{r ",options,"}",sep = ""),code,"```",sep="\n")}


# Available info
flags <- lapply(andiacare::allowedAndiacareReportCols(), function(col){
    return(col %in% colnames(cohort))
})
names(flags) <- andiacare::allowedAndiacareReportCols()
algorithms <- flags[names(andiacare::allowedDiabetesClassifiers())]

out_info <- ""

```

This document has been automatically generated by andiacare R package.

# **Cohort stats**
Allowed info found into this cohort are:
```{r includeCols, echo = FALSE}
auxnames <- colnames(cohort)
out_info <- paste(paste("* ",auxnames),collapse="\n")
out_info <- paste(out_info, "\n\n",
        paste0("That info is available for **(`r nrow(cohort)`) patients**",
                ifelse(flags$Source,
            " from **(`r length(levels(cohort$Source))`) different sources**",
            ""),
                ".",
                ifelse(nrow(removableEntries) > 0,
                paste0(" There are also a set of (", nrow(removableEntries),
                    ") patients which **have been removed** because of QA ",
                    "reasons",
                    ifelse(anyAdult,
                        paste0("and pediatric filtering (", sum(!ageChecks),
                            ")"),
                        ""),
                    ". **You can see them at the end of this report**."),
                "")),
        collapse = "\n")
```
`r paste(knitr::knit(text = paste(out_info,collapse = "\n")),collapse = "\n")`

```{r stats_section, echo = FALSE}
out_info <- "\n\n"

out_info <- paste(out_info, "\n",
                ifelse(any(c(flags$Source)),
                        knitr::knit_expand("partial_sources.Rmd"),
                        ""),
                "\n\n",
                ifelse(any(c(flags$Birthdate)),
                        knitr::knit_expand("partial_age.Rmd"),
                        ""),
                "\n\n",
                ifelse(any(c(flags$Debut)),
                        knitr::knit_expand("partial_debut.Rmd"),
                        ""),
                "\n\n",
                ifelse(flags$CV | (flags$SD & flags$GlucoseMean),
                        knitr::knit_expand("partial_glucose.Rmd"),
                        ""),
                "\n\n",
                ifelse(any(c(flags$TIR,flags$TBR,flags$TAR)),
                        knitr::knit_expand("partial_txr.Rmd"),
                        ""),
                "\n\n",
                ifelse(flags$MeanReads,
                        knitr::knit_expand("partial_meanreads.Rmd"),
                        ""),
                "\n\n",
                ifelse(any(c(flags$TIR,flags$TBR,flags$TAR)),
                        knitr::knit_expand("partial_attd.Rmd"),
                        ""),
                "\n\n",
                knitr::knit_expand("partial_cors.Rmd"),
                sep = "\n")

```

`r paste(c(knitr::knit(text = paste(out_info,collapse = "\n")),"\n"),collapse = "\n")`



# **Algorithms**

The following (`r sum(unlist(algorithms))`) algorithms have been performed:

```{r algs_info, echo = FALSE}
auxalgs <- which(unlist(algorithms))
auxalgs <- names(algorithms)[auxalgs]
out_info <- paste(paste("* ", auxalgs), collapse = "\n")
```
`r paste(c(knitr::knit(text = paste(out_info,collapse = "\n")),"\n"),collapse = "\n")`

```{r algs_subsections, echo = FALSE}
graphlist_algs <- list()
out_info <- ""
if (flags$Andiacare) {
    out_info <- paste(out_info, "\n",
        knitr::knit_expand("partial_andiacare.Rmd"), sep = "\n")
}
if (flags$GRI) {
    if(!all(cohort$GRI == "Not allowed")){
        out_info <- paste(out_info, "\n",
            knitr::knit_expand("partial_gri.Rmd"), sep = "\n")
    }else{
       algorithms$GRI <- FALSE 
    }
}

if(sum(unlist(algorithms)) > 1){
    out_info <- paste(out_info, "\n",
                knitr::knit_expand("partial_algorithms_comparisson.Rmd"),
                sep = "\n")
}

```
`r paste(c(knitr::knit(text = paste(out_info,collapse = "\n")),"\n"),collapse = "\n")`

```{r removable_pats, echo = FALSE}
out_info <- ""
if(nrow(removableEntries) > 0){
    out_info <- paste("\n",
        knitr::knit_expand("partial_removableEntries.Rmd"), sep = "\n")
}
```
`r paste(c(knitr::knit(text = paste(out_info,collapse = "\n")),"\n"),collapse = "\n")`

